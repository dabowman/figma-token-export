<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Downloading...</title>
</head>
<body>
<script>
  window.onmessage = async (event) => {
    const message = event.data.pluginMessage;
    if (message.type === 'download-raw-data') {
      const { payload, filename } = message;
      try {
        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;

        // Append to body to ensure click works in all browsers
        document.body.appendChild(link);
        link.click();

        // Clean up
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        // Optional: Notify main thread that download is complete
        // parent.postMessage({ pluginMessage: { type: 'download-complete' } }, '*');

      } catch (error) {
        console.error('Error triggering download:', error);
        // Optionally notify the main thread of the error
        parent.postMessage({ pluginMessage: { type: 'download-error', error: error.message } }, '*');
      }
    }
  }
</script>
</body>
</html> 