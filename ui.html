<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Downloading...</title>
</head>
<body>
<script>
  window.onmessage = async (event) => {
    const message = event.data.pluginMessage;
    
    if (message.type === 'download-tokens') {
      const { files } = message;
      
      try {
        // Download each file with a small delay between them
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          const blob = new Blob([file.content], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = file.filename;

          // Append to body to ensure click works in all browsers
          document.body.appendChild(link);
          link.click();

          // Clean up
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
          
          // Add a small delay between downloads to prevent browser issues
          if (i < files.length - 1) {
            await new Promise(resolve => setTimeout(resolve, 100));
          }
        }

        // Optional: Notify main thread that downloads are complete
        // parent.postMessage({ pluginMessage: { type: 'downloads-complete' } }, '*');

      } catch (error) {
        console.error('Error triggering downloads:', error);
        // Optionally notify the main thread of the error
        parent.postMessage({ pluginMessage: { type: 'download-error', error: error.message } }, '*');
      }
    }
  }
</script>
</body>
</html> 